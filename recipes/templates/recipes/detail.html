{% extends 'base.html' %}

{% load markdownify %}

{% block content %}
<main class="recipe-detail">
  <div>
    <a href="{% url 'recipe_edit' recipe.id %}">Edit</a>
    <a href="{% url 'recipe_delete' recipe.id %}">Delete</a>
  </div>
  {% if recipe.image %}
  <img src="{{ recipe.image }}" class="pull-right">
  {% endif %}
  <h1>{{ recipe.name }}</h1>
  <h2>Author: {{ recipe.author | default_if_none:"Unknown" }}</h2>
  <p>
    Created on {{ recipe.created }} |
    Updated on {{ recipe.updated }}
  </p>

  {{ servings_input.value }}

  {% if recipe.servings %}
  {% load resize %}
  {% if servings_input is None %}
  <p>Serves {{ recipe.servings }}</p>
  {% else %}
  <p>Serves {{ servings_input }}</p>
  {% endif %}
  {% endif %}


  <form method="get">
    <input name="servings_input" type="number" required="True" min="1">
    <button>Resize</button>
  </form>
  <form method="post" action="{% url 'recipe_rating' recipe.id %}">
    {% csrf_token %}
    <div class="rating-form-grid">
      {{ rating_form.as_p }}
      <button class="button">Rate</button>
    </div>
  </form>
  <p>Tags: {% for tag in recipe.tags.all %}{{ tag.word }} {% endfor %}</p>
  {{ recipe.description | markdownify }}
  <h2>Ingredients</h2>
  <table>
    <thead>
      <tr>
        <th colspan="2">Amount</th>
        <th>Food item</th>
      </tr>
    </thead>
    <tbody>
      {% for ingredient in recipe.ingredients.all %}
      {{ servings_input }}
      {% if servings_input %}
      {% load resize %}
      {{ ingredient| resize_to:servings_input }}
      {% endif %}

      <tr>
        <td>{{ ingredient.amount }}</td>
        <td>{{ ingredient.measure.name }}</td>
        <td>{{ ingredient.food.name }}</td>

        {% if ingredient.food not in food_in_shopping_list %}
        <td>
          <form method="post" action="{% url 'shoppingitem_create' %}">
            {% csrf_token %}
            <!-- identifies ingredient_id for each food item for a given recipe -->
            <input type="hidden" name="ingredient_id" value="{{ ingredient.id }}">
            <button>+ shopping list</button>
          </form>
        </td>
        {% endif %}

      </tr>
      {% endfor %}
    </tbody>
  </table>
  <h2>Steps</h2>
  <ol>
    {% for step in recipe.steps.all %}
    <li>{{ step.directions }}</li>
    {% endfor %}
  </ol>
</main>
{% endblock content %}
